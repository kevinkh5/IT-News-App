# IT 영문 뉴스기사 TTS & 요약 서비스
https://baduks.store/

<img src='./demo.gif' width=800 alt='demo'> </img>

개인적으로 영어 공부할 시간 내기 부담스러운 바쁜

- 공대생
- 개발자 
- 기술에 관심있는 모든 사람

들을 위한 **IT 영어 기사 리딩앱**.

**매일 새로운 흥미로운 IT 기사를 읽으며 IT 트렌드도 빠르게 파악하고, 영어실력도 높여보아요!**

## 서비스 목표
- IT최신기술 트렌드 빠르게 파악

- TTS기능으로 영어청취능력 향상

## 기능
- 영문기사를 TTS를 통해 음성으로 읽어준다
- 기사원문을 간단하게 요약하여 보여준다.

## Tech Stack

### Frontend
- Vanila.JS, HTML, CSS
> React 또는 Vue와 같은 프레임워크를 사용하지 않고 순수자바스크립트로 화면을 구현하였습니다.

### Backend
- Flask
> 해당앱은 간단한 웹 어플리케이션으로 빠르게 구현 가능한 마이크로프레임워크인 Flask를 사용하였습니다.

### Database
- PostgreSQL

### Third-Party-Library
- PYTHON BeautifulSoup
- OPEN AI TTS
- Langchain(프롬프트엔지니어링)

### 개발 운영을 위한 기술
- Docker
- Nginx

## Backend Logic
- 서버에서 페이지 크롤링시 비동기방식으로 request하여 빠르게 처리합니다.

## 고독한 8일간의 개발 과정 기록🥹 (2024/08/06 ~ 2024/08/13)

<details>
    <summary>궁금하다면? 클릭!</summary>
    
- 2024/08/06
    - 프로젝트 시작!
    - index 페이지, css, js로 반응형 페이지 간단하게 구현하기 (완료)

- 2024/08/07
    - 백엔드에서 크롤링한 기사 카테고리 나눠서 데이터 다 가져오기 (완료)
    - 화면에 크롤링한 데이터를 가지고 카드데이터를 가져와서 화면에 보이기 (완료)
    - DB에 어떻게 넣을지 스키마 구상 (완료)
    - 뉴스기사 페이지 html 구현 (완료)
    - 백엔드(Flask)에서 axios로 데이터 가져오기 (완료)
    - psycopg2 no module 이슈 ->pip install psycopg2-binary=2.9.9로 해결 (완료)
    
- 2024/08/08
    - 비동기처리를 promise로 동기적으로 처리하도록 해서 화살표버튼이 작동하도록 이슈해결하기 (완료)
    - DB 연결 : PostgresSQL-Flask (완료)
    - python으로 PostgresSQL에 데이터 삽입 (완료)
    - PosgresSQL에서 flask로 데이터 가져와서 화면에 표시 (완료)

- 2024/08/09
    - 뉴스기사 크롤러 구현 (완료)
    - 디테일 페이지 관련 백엔드 API 라우터 구현 (완료)
    - html을 서버에서 직접 생성해서 제공하는 서버사이드 렌더링 방식이 아닌 SPA 방식으로 디테일페이지 구현 (완료) (빠른 화면전환으로 사용자 경험 높이기 위해, 또한 개인적으로 백엔드와 프론트엔드를 분리한 API 중심 개발 경험을 쌓기 위해)
    - 실제 크롤링한 데이터를 DB에 저장한 후 API로 데이터 가져와서 화면에 표시 (완료)
    - 디테일 페이지 크롤링 할 때 Request GET 요청을 비동기 처리해서 가져오기 (Ongoing)

- 2024/08/10
    - 디테일 페이지 크롤링 할 때 Request GET 요청을 비동기 처리해서 가져오기 (완료)
        - news_info에서 created_at을 조건으로 모든 데이터 가져온다
        - News_info의 id가 news_content테이블에 있는지 확인한다
        - 있는것은 continue 시키고, 없는 것만, url-id 맵핑 테이블과 url만 담는 리스트에 url을 담는다.
        - 담겨진 url을 비동기처리한다. (서버 과부하 방지를 위해 3초 쉬고, 5개씩 끊어서 진행시킨다.)
    - Author, Date, Img 화면 표시(완료)
    - 재생바 만들기(완료)
    - 텍스트 음원 생성(tts) 배치 만들기(완료)
        - news_content테이블에서 news_info_id, description 불러오기
        - description text로 음성 생성후 audio폴더에 저장
        - 이때, 파일 이름은 news_info_id로 저장한다.
        
- 2024/08/11
    - 코드 클린 & 최적화 작업 (완료)
        - Frontend
            - index.html
            - style.css
            - main.js
        - Backend
            - app.py
            - crawling_info.py (첫페이지 구성을 위한 데이터 준비 배치)
            - crawing_detail.py (디테일 페이지를 위한 데이터 준비 배치)
            - tts_batch.py (tts api 활용 음성파일 준비 배치)
            - summary_batch.py (open ai api 및 langchain 활용, 요약 데이터 준비 배치)
    - env파일에 API key, DB Pw, 등 민감한 정보 안전하게 보관하기(완료)
    - AWS EC2 인스턴스(Elastic ip) & 도커셋업(완료)
    - 도메인 구입 및 고정IP에 등록(완료)
    
- 2024/08/12
    - 도커에 띄워야할 컨테이너 정리 및 컴포즈파일 작성 & 설정(완료)
        - DB
        - Batch1
        - Batch2
        - Batch3
        - Batch4
        - Flask
        - Nginx reverse proxy
        - Nginx server
        - Certbot
    - 컨테이너간 DB서버 연결 (완료)
    - Certbot 인증서 관련 이슈 발생(Ongoing, 몇시간째 컨테이너들 지우고 새로 깔고를 여러가지 방법을 동원하는데도 해결 안돼서 지침.., openai API 요청 코드가 작성된 배치 컨테이너들은 또  잘돌아서 API 비용만 0.68$ 나감…ㅋㅋ 발란스 3.3$남음ㅠㅠ)
    - TTS배치 컨테이너에 있는 음원파일(TTS 다운로드 경로 확인 필요)을 nginx 컨테이너로 넘겨줘야하므로 컨테이너 간 연결작업 필요(Ongoing)

- 2024/08/13
    - certbot HTTPS 테스트 및 구현 (완료) (certbot인증서 이슈 : https 인증서 못가져온 원인은 certbot폴더 안에서 live폴더 안에 경로명이 달라져서 였음.  변경해서 해결함)
    - Nginx proxy 이슈 해결 (완료): flask를 nginx.conf upstream에서 못찾는 이슈가 있었는데, 도커 컴포즈 파일에서 networks를 같이 맞춰주니까 해결됨
    - 음원파일 flask로 response주는 부분 구현 (완료)
    - 뉴스기사 최신 날짜 순서로 정렬 앞단 js코드 수정 (완료)
    - 도커 컨테이너 4개(Nginx, Nginx Reverse Proxy, Flask, PostgreSQL) 안정적으로 가동성공!

</details>

## 프로젝트 비용
- OpenAI API - 뉴스기사 6개 기준 tts - 0.2$, gpt4-turbo - 0.1$로 하루 0.3$ 비용 발생...🥲
- 도메인(가비아) - 1년에 550원 (커피 한잔보다도 저렴☕️)
- AWS - EC2-T2.micro 프리티어로 아직 공짜

## 프로젝트 후기
이번 8일간의 프로젝트를 통해서 프론트엔드 개발, 백엔드 개발, AWS와 도커를 사용한 개발운영까지 전체적인 개발 프로세스를 경험해 볼 수 있었다.

특히 자바스크립트 코드, HTML(여러가지 태그가 너무 많다..), CSS(미디어쿼리, 패딩값 조정 등..)도 익숙하지 않아서 프론트엔드개발 할 때도 고생을 많이했다. 개발 하는 과정에서 겪었던 다양한 이슈들은 다행히 ChatGPT의 도움을 받아 상당 부분 해결할 수 있었다.

또한 도커를 배운지 얼마 안돼서 도커파일, 도커 컴포즈 파일 작성, 다양한 도커 명령들도 익숙하지 않아 고생을 많이했고, 그리고 가장 어렵게 느껴졌던, 도커내 nginx 설정, https지원을 위한 certbot 인증서 셋업 부분이 계속 안돼서 이 부분에서 정말 스트레스를 많이 받았었다. 컨테이너를 계속 지웠다 깔고, 심지어는 EC2 인스턴스까지 terminate시켰다가 다시 launch해서 도커도 다시 새로 설치하는 등.. 굉장히 삽질을 많이했다. 그래도 이 또한 결국 구글링과 GPT를 활용하여 해결하였다.

결국 이번 프로젝트를 완료하였고, 덕분에 개발에 대한 자신감도 조금 올라간 것 같다. 물론 아직도 많이 부족하고 계속 배워야겠지만!

## 프로젝트를 완성하긴했지만 좀 아쉬운점
1. 프론트엔드 부분에서 뉴스카드를 드래그 하는데 있어서 좀 불편함이 있다. 이 부분을 개선하고자 했지만, 시간이 좀 걸릴 것 같아서 일단은 넘겼다. 추후 프론트엔드 부분을 좀 더 보완해야할 것 같다.

2. OpenAI API 비용. 생각보다 API비용이 많이 나간다. 특히 TTS API는 뉴스 기사 1개당 2~3분 가량의 오디오 파일을 생성해야하므로 비용이 꽤 발생한다. 이 부분은 이후 무료 TTS API인 edge_tts로 교체할 예정이다. edge_tts가 무료인것 치고 퀄리티가 상당히 좋다. 물론 인토네이션 부분은 확실히 유료보다는 좀 덜 자연스러운 것 같다. 뉴스기사 요약의 경우도 마찬가지로 OpenAI API를 사용하여 Langchain으로 프롬프트 엔지니어링을 하고 있는데, 이것 역시 비용이 발생하고 있다. 오픈소스인 Ollama를 활용하여 비용을 막을 수도 있겠지만 Ollama를 사용하려면 GPU가 있는 스펙 좋은 EC2를 대여해야 한다는 점 때문에 포기했다…




















